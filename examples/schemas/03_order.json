{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "order.json",
  "title": "Order",
  "description": "E-commerce order with line items and shipping",
  "type": "object",
  "definitions": {
    "Address": {
      "type": "object",
      "properties": {
        "firstName": { "type": "string" },
        "lastName": { "type": "string" },
        "company": { "type": "string" },
        "street1": { "type": "string" },
        "street2": { "type": "string" },
        "city": { "type": "string" },
        "state": { "type": "string" },
        "postalCode": { "type": "string" },
        "country": { "type": "string", "minLength": 2, "maxLength": 2 },
        "phone": { "type": "string" }
      },
      "required": ["firstName", "lastName", "street1", "city", "postalCode", "country"]
    },
    "LineItem": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "productId": { "type": "string", "format": "uuid" },
        "variantId": { "type": "string", "format": "uuid" },
        "name": { "type": "string" },
        "sku": { "type": "string" },
        "quantity": { "type": "integer", "minimum": 1 },
        "unitPrice": { "type": "integer", "minimum": 0 },
        "totalPrice": { "type": "integer", "minimum": 0 },
        "discount": { "$ref": "#/definitions/Discount" }
      },
      "required": ["id", "productId", "name", "quantity", "unitPrice"]
    },
    "Discount": {
      "type": "object",
      "properties": {
        "code": { "type": "string" },
        "type": { "type": "string", "enum": ["percentage", "fixed"] },
        "value": { "type": "number", "minimum": 0 },
        "amount": { "type": "integer", "minimum": 0 }
      },
      "required": ["type", "value"]
    },
    "Payment": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "method": { "type": "string", "enum": ["card", "paypal", "bank_transfer", "cod"] },
        "status": { "type": "string", "enum": ["pending", "authorized", "captured", "refunded", "failed"] },
        "amount": { "type": "integer" },
        "currency": { "type": "string" },
        "transactionId": { "type": "string" },
        "paidAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "method", "status", "amount"]
    },
    "Shipment": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "carrier": { "type": "string" },
        "trackingNumber": { "type": "string" },
        "status": { "type": "string", "enum": ["pending", "shipped", "in_transit", "delivered", "returned"] },
        "shippedAt": { "type": "string", "format": "date-time" },
        "deliveredAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "status"]
    }
  },
  "properties": {
    "id": { "type": "string", "format": "uuid" },
    "orderNumber": { "type": "string" },
    "customerId": { "type": "string", "format": "uuid" },
    "status": { "type": "string", "enum": ["pending", "confirmed", "processing", "shipped", "delivered", "cancelled"] },
    "lineItems": { "type": "array", "items": { "$ref": "#/definitions/LineItem" }, "minItems": 1 },
    "shippingAddress": { "$ref": "#/definitions/Address" },
    "billingAddress": { "$ref": "#/definitions/Address" },
    "subtotal": { "type": "integer" },
    "shippingCost": { "type": "integer" },
    "tax": { "type": "integer" },
    "total": { "type": "integer" },
    "currency": { "type": "string" },
    "discounts": { "type": "array", "items": { "$ref": "#/definitions/Discount" } },
    "payments": { "type": "array", "items": { "$ref": "#/definitions/Payment" } },
    "shipments": { "type": "array", "items": { "$ref": "#/definitions/Shipment" } },
    "notes": { "type": "string" },
    "createdAt": { "type": "string", "format": "date-time" },
    "updatedAt": { "type": "string", "format": "date-time" }
  },
  "required": ["id", "orderNumber", "customerId", "status", "lineItems", "shippingAddress", "total", "currency"]
}
