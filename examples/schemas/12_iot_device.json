{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "iot_device.json",
  "title": "IoTDevice",
  "description": "IoT device with telemetry and commands",
  "type": "object",
  "definitions": {
    "Telemetry": {
      "type": "object",
      "properties": {
        "timestamp": { "type": "string", "format": "date-time" },
        "temperature": { "type": "number" },
        "humidity": { "type": "number", "minimum": 0, "maximum": 100 },
        "pressure": { "type": "number" },
        "battery": { "type": "number", "minimum": 0, "maximum": 100 },
        "signal": { "type": "integer", "minimum": -120, "maximum": 0 },
        "custom": { "type": "object", "additionalProperties": true }
      },
      "required": ["timestamp"]
    },
    "Command": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "parameters": { "type": "object", "additionalProperties": true },
        "timeout": { "type": "integer", "minimum": 0 },
        "qos": { "type": "integer", "enum": [0, 1, 2] }
      },
      "required": ["id", "name"]
    },
    "Firmware": {
      "type": "object",
      "properties": {
        "version": { "type": "string" },
        "buildDate": { "type": "string", "format": "date" },
        "checksum": { "type": "string" },
        "updateAvailable": { "type": "boolean" },
        "lastUpdated": { "type": "string", "format": "date-time" }
      },
      "required": ["version"]
    },
    "NetworkConfig": {
      "type": "object",
      "properties": {
        "type": { "type": "string", "enum": ["wifi", "ethernet", "cellular", "lora", "zigbee", "bluetooth"] },
        "ipAddress": { "type": "string", "format": "ipv4" },
        "macAddress": { "type": "string", "pattern": "^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$" },
        "ssid": { "type": "string" },
        "rssi": { "type": "integer" }
      },
      "required": ["type"]
    },
    "Alert": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string", "enum": ["warning", "error", "critical"] },
        "message": { "type": "string" },
        "triggeredAt": { "type": "string", "format": "date-time" },
        "acknowledged": { "type": "boolean", "default": false }
      },
      "required": ["id", "type", "message", "triggeredAt"]
    }
  },
  "properties": {
    "id": { "type": "string", "format": "uuid" },
    "serialNumber": { "type": "string" },
    "name": { "type": "string" },
    "type": { "type": "string", "enum": ["sensor", "actuator", "gateway", "controller"] },
    "model": { "type": "string" },
    "manufacturer": { "type": "string" },
    "status": { "type": "string", "enum": ["online", "offline", "error", "maintenance"] },
    "firmware": { "$ref": "#/definitions/Firmware" },
    "network": { "$ref": "#/definitions/NetworkConfig" },
    "location": {
      "type": "object",
      "properties": {
        "latitude": { "type": "number" },
        "longitude": { "type": "number" },
        "altitude": { "type": "number" },
        "floor": { "type": "string" },
        "room": { "type": "string" }
      }
    },
    "telemetry": { "$ref": "#/definitions/Telemetry" },
    "commands": { "type": "array", "items": { "$ref": "#/definitions/Command" } },
    "alerts": { "type": "array", "items": { "$ref": "#/definitions/Alert" } },
    "tags": { "type": "array", "items": { "type": "string" } },
    "metadata": { "type": "object", "additionalProperties": true },
    "lastSeen": { "type": "string", "format": "date-time" },
    "registeredAt": { "type": "string", "format": "date-time" }
  },
  "required": ["id", "serialNumber", "type", "status"]
}
